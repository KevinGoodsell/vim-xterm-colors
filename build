#!/usr/bin/env python

import sys
import os

import fabricate

# These use exec:
# astronaut.vim (variable expansion)
# marklar.vim (variable expansion)
# twilight.vim (variable expansion)
# two2tango.vim (variable expansion)
#

dark_schemes = [
    'BlackSea.vim',
    'ChocolateLiquor.vim',
    'adaryn.vim',
    'adrian.vim',
    'aiseered.vim',
    'anotherdark.vim',
    'aqua.vim',
    'asu1dark.vim',
    'bluegreen.vim',
    'borland.vim',
    'breeze.vim',
    'brookstream.vim',
    'camo.vim',
    'candy.vim',
    'candycode.vim',
    'clarity.vim',
    'cleanphp.vim',
    'colorer.vim',
    'dante.vim',
    'darkZ.vim',
    'darkblue2.vim',
    'darkbone.vim',
    'darkslategray.vim',
    'darkspectrum.vim',
    'denim.vim',
    'desertEx.vim',
    'dusk.vim',
    'dw_blue.vim',
    'dw_cyan.vim',
    'dw_green.vim',
    'dw_orange.vim',
    'dw_purple.vim',
    'dw_red.vim',
    'dw_yellow.vim',
    'ekvoli.vim',
    'fnaqevan.vim',
    'freya.vim',
    'fruity.vim',
    'golden.vim',
    'guardian.vim',
    'herald.vim',
    'inkpot.vim',
    'ir_black.vim',
    'jammy.vim',
    'kellys.vim',
    'leo.vim',
    'lucius.vim',
    'manxome.vim',
    'maroloccio.vim',
    'matrix.vim',
    'molokai.vim',
    'moss.vim',
    'motus.vim',
    'mustang.vim',
    'navajo-night.vim',
    'neon.vim',
    'neverness.vim',
    'night.vim',
    'nightshimmer.vim',
    'no_quarter.vim',
    'northland.vim',
    'oceanblack.vim',
    'oceandeep.vim',
    'olive.vim',
    'railscasts.vim',
    'rdark.vim',
    'relaxedgreen.vim',
    'robinhood.vim',
    'rootwater.vim',
    'sea.vim',
    'settlemyer.vim',
    'softblue.vim',
    'synic.vim',
    'tabula.vim',
    'tango.vim',
    'tango2.vim',
    'tir_black.vim',
    'torte.vim',
    'vibrantink.vim',
    'vividchalk.vim',
    'wombat.vim',
    'wood.vim',
    'wuye.vim',
    'xemacs.vim',
    'xoria256.vim',
    'zenburn.vim',
    'zmrok.vim',

    # These ones use existing 'background' setting rather than setting it
    # explicitly:
    'baycomb.vim',
    'earendel.vim',
    'moria.vim',
    #'peaksea.vim',
    #'sienna.vim',
]

light_schemes = [
    'PapayaWhip.vim',
    'autumn.vim',
    'autumn2.vim',
    'autumnleaf.vim',
    'bclear.vim',
    'biogoo.vim',
    'buttercream.vim',
    'chela_light.vim',
    'dawn.vim',
    'eclipse.vim',
    'fine_blue.vim',
    'fog.vim',
    'fruit.vim',
    'habiLight.vim',
    'ironman.vim',
    'martin_krischik.vim',
    'navajo.vim',
    'nuvola.vim',
    'oceanlight.vim',
    'print_bw.vim',
    'pyte.vim',
    'satori.vim',
    'silent.vim',
    'simpleandfriendly.vim',
    'soso.vim',
    'spring.vim',
    'taqua.vim',
    'tcsoft.vim',
    'tolerable.vim',
    'vc.vim',
    'vylight.vim',
    'winter.vim',
]

patch_only = [
    'lettuce.vim', # separate gui & cterm sections with non-convertible bits

    # These calculate the terminal color from the gui color:
    'desert256.vim',
    'jellybeans.vim',
    'summerfruit256.vim',
    'wombat256.vim',

    # These calculate the gui color from the terminal color:
    'calmar256-dark.vim',
    'calmar256-light.vim',
]

def mkdir(path):
    try:
        os.makedirs(path)
    except OSError:
        pass

def patch(scheme):
    patch_file = os.path.join('patches', scheme + '.diff')
    if os.path.exists(patch_file):
        fabricate.run('sh', '-c',
                      'patch -p0 -o patched/%s originals/%s < %s' %
                      (scheme, scheme, patch_file))
    else:
        fabricate.run('cp', os.path.join('originals', scheme), 'patched/')

def build():
    mkdir('patched')
    for scheme in dark_schemes + light_schemes + patch_only:
        patch(scheme)

    mkdir('term')
    for scheme in dark_schemes:
        fabricate.run('sh', '-c', './scripts/gui2xterm patched/' +
                                  scheme + ' > term/' + scheme)

    for scheme in light_schemes:
        fabricate.run('sh', '-c', './scripts/gui2xterm --light patched/' +
                                  scheme + ' > term/' + scheme)

    for scheme in patch_only:
        fabricate.run('cp', 'patched/' + scheme, 'term/')

if __name__ == '__main__':
    fabricate.main()
